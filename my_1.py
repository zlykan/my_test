import pandas as pd
import numpy as np
import csv as csv

#################### train_df
df = pd.read_csv('train.csv', header=0)

print ' '
print 'check "NaN" in each column'
for i in range(df.shape[1]):
  t=len(df[df.iloc[:,i].isnull()]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
  if t>0:
     print df.columns[i],t
print ' '


df=df.drop(['PassengerId','Name','SibSp','Parch','Ticket'],axis=1)

#Cabin: [none or some] => [0 or 1]
df.Cabin.loc[df.Cabin.notnull()]=1
df.Cabin.loc[df.Cabin.isnull()]=0

#Sex: [female or male] => [0 or 1]
df.Sex=df.Sex.map({'female':0,'male':1}).astype(int)

#Embarked: [S or C or Q] => [0 or 1 or 2]
df.Embarked=df.Embarked.map({'S':0,'C':1,'Q':2,np.nan:0}).astype(int)

#Age: [nan] => [median_age]  *this could be more precise
df.Age.loc[df.Age.isnull()]=df.Age.dropna().median()

train_df=df.copy()
train_label=train_df.values[:,0].astype(int)
train_data=train_df.values[:,1:]


#################### test_df
df = pd.read_csv('test.csv', header=0)
print ' '
print 'check "NaN" in each column'
for i in range(df.shape[1]):
  t=len(df[df.iloc[:,i].isnull()]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              )
  if t>0:
     print df.columns[i],t
print ' '

ids=df['PassengerId']

df=df.drop(['PassengerId','Name','SibSp','Parch','Ticket'],axis=1)

#Cabin: [none or some] => [0 or 1]
df.Cabin.loc[df.Cabin.notnull()]=1
df.Cabin.loc[df.Cabin.isnull()]=0

#Sex: [female or male] => [0 or 1]
df.Sex=df.Sex.map({'female':0,'male':1}).astype(int)

#Fare:[nan] => [median_age]
df.Fare.loc[df.Fare.isnull()]=13  

#Embarked: [S or C or Q] => [0 or 1 or 2]  
df.Embarked=df.Embarked.map({'S':0,'C':1,'Q':2,np.nan:0}).astype(int)

#Age: [nan] => [median_age]  *this could be more precise
df.Age.loc[df.Age.isnull()]=df.Age.dropna().median()

test_df=df.copy()

from sklearn import preprocessing
minmaxscale=preprocessing.MinMaxScaler(feature_range=(0,1))
train_data=minmaxscale.fit_transform(train_data)
test_data=minmaxscale.fit_transform(test_df.values)

print np.shape(train_data)
print np.shape(test_data)


print 'Training...'
#from sklearn.ensemble import RandomForestClassifier
#clf = RandomForestClassifier(n_estimators=100)#0.8035

#from sklearn.neighbors import KNeighborsClassifier  
#clf=KNeighborsClassifier(n_neighbors=7)#0.7800

from sklearn import svm   
clf=svm.SVC(C=10,gamma=0.0029)#0.7867
#clf=GridSearchCV(svm.SVC(), param_grid={"C":np.logspace(-2, 10, 13),"gamma":np.logspace(-9, 3, 13)})
#output = clf.fit( train_data[0::,1::], train_data[0::,0] ).predict(test_data).astype(int)
#print("The best parameters are %s with a score of %0.2f"% (knnClf.best_params_, knnClf.best_score_))

#from sklearn.naive_bayes import GaussianNB      #nb for 高斯分布的数据
#clf=GaussianNB() #0.7609       

#from sklearn.linear_model import LogisticRegression
#clf = LogisticRegression(C=1,penalty='l2',tol=0.0001)#0.7833

#from sklearn.ensemble import GradientBoostingClassifier
#clf=GradientBoostingClassifier(n_estimators=13)#0.8058

#from sklearn.ensemble import ExtraTreesClassifier
#clf=ExtraTreesClassifier(n_estimators=14, max_depth=None,min_samples_split=1, random_state=0)#0.7968

#from sklearn.ensemble import AdaBoostClassifier
#clf = AdaBoostClassifier(n_estimators=100)#0.8114

#from sklearn.ensemble import GradientBoostingClassifier
#clf = GradientBoostingClassifier(n_estimators=100, learning_rate=1.0,max_depth=1, random_state=0)#0.8024

#from sklearn.tree import DecisionTreeClassifier
#clf = DecisionTreeClassifier(max_depth=None, min_samples_split=1,random_state=1)#0.7766



from sklearn.cross_validation import cross_val_score
print cross_val_score(clf, train_data, train_label).mean()



output = clf.fit(train_data, train_label).predict(test_data).astype(int)
#print df.head(1)
#print clf.feature_importances_



predictions_file = open('result.csv', "wb")
open_file_object = csv.writer(predictions_file)
open_file_object.writerow(["PassengerId","Survived"])
open_file_object.writerows(zip(ids, output))
predictions_file.close()

